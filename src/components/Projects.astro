---
import { projects } from '@/constants'
---

<main id='projects' class='relative p-8 flex overflow-hidden'>
  <div></div>
  <div
    class='absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black/50 to-transparent backdrop-blur-sm z-0'
  >
  </div>
  <section
    class='grid lg:grid-cols-2 md:grid-cols-2 grid-cols-1 gap-8 space-x-4 max-w-7xl mx-auto w-full place-items-center relative z-10'
  >
    {
      projects.map((project) => (
        <div class='flex items-center justify-center flex-1 project-card'>
          <div class='content'>
            <div class='main-content'>
              <div class='relative h-[50%] w-[100%] max-h-[400px]'>
                {project.image && (
                  <img
                    class='aspect-3/2 object-cover'
                    src={project.image}
                    alt={project.title}
                  />
                )}
              </div>
              <div class='relative z-[1] flex flex-col gap-8 p-8 mx-4'>
                <div class='flex flex-col w-[100%] justify-between items-center'>
                  <h1 class='py-6'>{project.title}</h1>
                  <div class='title-info'>
                    <div class='song'>
                      <p class='font-medium text-6xl text-[rgba(255, 255, 255, 0.45)]'>
                        {project.technologies.join(', ')}
                      </p>
                    </div>
                    <div class='song'>
                      <p class='font-medium text-6xl text-[rgba(255, 255, 255, 0.45)]'>
                        {project.description}
                      </p>
                    </div>
                  </div>
                </div>

                <div class='songs flex flex-col justify-stretch gap-1.5'>
                  <div class='song song-open'>
                    <p class='bold'>{project.title}</p>
                    <div class='end'>
                      <svg
                        width='24'
                        height='24'
                        viewBox='0 0 24 24'
                        fill='none'
                        xmlns='http://www.w3.org/2000/svg'
                      >
                        <path
                          d='M5 10C3.9 10 3 10.9 3 12C3 13.1 3.9 14 5 14C6.1 14 7 13.1 7 12C7 10.9 6.1 10 5 10ZM19 10C17.9 10 17 10.9 17 12C17 13.1 17.9 14 19 14C20.1 14 21 13.1 21 12C21 10.9 20.1 10 19 10ZM12 10C10.9 10 10 10.9 10 12C10 13.1 10.9 14 12 14C13.1 14 14 13.1 14 12C14 10.9 13.1 10 12 10Z'
                          fill='white'
                        />
                      </svg>
                      <p class='font-medium text-6xl text-[rgba(255, 255, 255, 0.45)]'>
                        View Details
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class='song-modal'>
              <div class='song'>
                <p class='bold'>Project Details</p>
                <div class='end song-close'>
                  <svg
                    width='24'
                    height='24'
                    viewBox='0 0 24 24'
                    fill='none'
                    xmlns='http://www.w3.org/2000/svg'
                  >
                    <path
                      d='M17.667 11.666H5.66699M11.667 5.66602V17.666'
                      stroke='white'
                      stroke-width='2'
                      stroke-linecap='round'
                      stroke-linejoin='round'
                    />
                  </svg>
                </div>
              </div>
              <div class='p-6 relative z-[3]'>
                <div class='flex items-center gap-1 relative z-[101]'>
                  <p class='font-medium text-6xl text-[rgba(255, 255, 255, 0.45)]'>
                    Technologies used
                  </p>
                </div>
                <br />
                <p class='bold'>Project Description</p>
                <br />
                <p class='bold'>{project.description}</p>
                <br />
                <div class='flex gap-4 mt-6'>
                  {project?.repoUrl && (
                    <a
                      href={project?.repoUrl}
                      target='_blank'
                      rel='noopener noreferrer'
                      class='project-link'
                    >
                      View Repository
                    </a>
                  )}
                  {project.deployUrl && (
                    <a
                      href={project.deployUrl}
                      target='_blank'
                      rel='noopener noreferrer'
                      class='project-link'
                    >
                      View Live Demo
                    </a>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      ))
    }
  </section>
</main>

<style>
  h1 {
    font-size: 40px;
    font-weight: 400;
  }

  p {
    font-size: 16px;
    letter-spacing: 0em;
    line-height: 140%;
  }

  p.bold {
    font-weight: 400;
    color: rgba(255, 255, 255, 0.65);
  }

  .content {
    position: relative;
    width: 100%;
    max-width: 800px;
    height: 100%;
    min-height: 500px;
    background: #161616;
    /* box-shadow: inset 0 0 150px rgba(52, 46, 45, 1); */
    display: flex;
    align-items: start;
    justify-content: start;
    gap: 16px;
    transform: translate3d(0, 0, 0);
    border-radius: 50px;
    border: 2px solid #232120;
    -webkit-border-radius: 50px;
    will-change: box-shadow;
    -webkit-will-change: box-shadow;
    transition: 1s cubic-bezier(0.17, 1, 0.33, 1);
  }

  .content.active {
    box-shadow: inset 0 0 150px rgba(52, 46, 45, 0.7);
    background: #0f0f0f;
  }

  .main-content {
    display: flex;
    flex-direction: column;
    position: relative;
    width: 100%;
    height: 100%;
    border-radius: 48px;
    -webkit-border-radius: 48px;
    overflow: hidden;
    transform: translate3d(0, 0, 0) scale(1);
    filter: blur(0px) brightness(1);
    will-change: transform, filter;
    -webkit-will-change: transform, filter;
    transition: 0.6s cubic-bezier(0.17, 1, 0.33, 1);
  }

  .content.active .main-content {
    transform: translate3d(0, 0, 0) scale(0.9);
    filter: blur(16px) brightness(0.7);
    transition: 0.3s ease-out;
  }

  .title-info {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding-right: 4px;
  }

  @media screen and (max-width: 600px) {
    .title-info {
      display: none;
    }
  }

  .song {
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-width: 100%;
    min-height: 72px;
    border-radius: 32px;
    border: 2px solid rgba(62, 196, 135, 0.432);
    padding: 0 22px;
    margin: 0 -22px;
    box-shadow: inset 0 0 0px 0 rgba(69, 176, 129, 0.397);
    transition: 0.2s ease;
    cursor: pointer;
  }

  .songs .song:hover {
    box-shadow: inset 0 0 64px 0 rgba(255, 255, 255, 0.075);
  }

  .end {
    display: flex;
    align-items: center;
    gap: 24px;
  }

  .song svg {
    opacity: 0;
    transition: 0.2s ease;
  }

  .songs .song:hover svg {
    opacity: 0.5;
  }

  .song svg:hover {
    opacity: 1 !important;
    cursor: pointer;
  }

  /* modals */

  .modal,
  .song-modal {
    position: absolute;
    z-index: 99;
    top: 0;
    left: 0;
    background: #272322;
    width: 96px;
    height: 96px;
    display: flex;
    align-items: start;
    justify-content: start;
    border-radius: 48px;
    -webkit-border-radius: 48px;
    transform: translateZ(0);
    overflow: hidden;
    will-change: width, height;
    -webkit-will-change: width, height;
    cursor: pointer;
    transition: 0.6s cubic-bezier(0.17, 1, 0.33, 1);
  }
  .modal.active {
    width: 500px;
    height: 500px;
    transition: 1s cubic-bezier(0.17, 1, 0.33, 1);
    cursor: auto;
  }

  .toggle {
    position: absolute;
    z-index: 5;
    top: 8px;
    left: 8px;
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0);
    backdrop-filter: blur(0px);
    opacity: 1;
    cursor: pointer;
    transition: 0.2s all;
  }

  .modal.active .toggle {
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(24px);
  }

  .modal.active .toggle:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .toggle svg {
    transform: rotateZ(0deg);
    transition: 1s cubic-bezier(0.32, 1.35, 0.75, 1);
  }
  .modal.active .toggle svg {
    transform: rotateZ(135deg);
  }

  .modal-content {
    position: absolute;
    min-width: 500px;
    height: 500px;
    display: flex;
    flex-flow: column;
    padding: 4px;
    transform: scale(0.8);
    transform-origin: top left;
    transition: transform 1s cubic-bezier(0.16, 0.61, 0.23, 1);
    z-index: 2;
  }
  .modal.active .modal-content {
    transform: scale(1);
  }

  .modal .photo {
    object-fit: cover;
  }

  .shade {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    opacity: 1;
    background: #272322;
    pointer-events: none;
    transition:
      0.2s linear 0.2s opacity,
      0.2s background;
  }

  .active .shade,
  .modal:hover .shade {
    background: #342e2d;
  }

  .content.active .shade {
    opacity: 0;
    transition: 0.2s all;
  }

  /* song modal */

  .song-modal {
    position: absolute;
    left: 10px;
    opacity: 0;
    height: 72px;
    width: calc(100% - 20px);
    padding: 0 0px;
    display: flex;
    flex-direction: column;
    align-items: center;
    pointer-events: none;
    transition:
      all 0.4s cubic-bezier(0.17, 1, 0.33, 1),
      top 0s,
      opacity 0.2s 0.4s;
  }

  .song-modal.active {
    opacity: 1;
    left: 0;
    width: 100%;
    height: 400px;
    padding: 0 10px;
    cursor: auto;
    pointer-events: all;
    transition:
      all 0.6s cubic-bezier(0.17, 1, 0.33, 1),
      top 0s,
      opacity 0s;
  }

  .song-modal .song {
    position: relative;
    z-index: 3;
    border: 2px solid rgba(255, 255, 255, 0);
    border-bottom: 2px solid rgba(255, 255, 255, 0.04);
    border-radius: 0px;
    cursor: auto;
    transition: all 0.4s cubic-bezier(0.17, 1, 0.33, 1);
  }

  .song-modal.active .song {
    min-height: 88px;
    transition: all 0.6s cubic-bezier(0.17, 1, 0.33, 1);
  }

  .song-modal .song .bold {
    transform: scale(1);
    transform-origin: center left;
    transition: all 0.4s cubic-bezier(0.17, 1, 0.33, 1);
  }

  .song-modal.active .song .bold {
    letter-spacing: -0.03em;
    transform: scale(2);
    color: rgba(255, 255, 255, 1);
    transition: all 0.6s cubic-bezier(0.17, 1, 0.33, 1);
  }

  .song-modal .end {
    transform: translateX(0);
    transition: transform 0.4s ease;
  }

  .song-modal.active .end {
    transform: translateX(10px);
    transition: transform 0.2s ease;
  }

  .song-modal .song svg {
    transform: rotateZ(0deg);
    transition: transform 1.2s cubic-bezier(0.32, 1.35, 0.75, 1) !important;
    opacity: 0.5;
  }

  .song-modal.active .song svg {
    transform: rotateZ(-495deg);
    opacity: 0.5;
  }

  .project-link {
    padding: 8px 16px;
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 24px;
    color: white;
    text-decoration: none;
    transition: all 0.2s ease;
  }

  .project-link:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.2);
  }

  .project-card {
    opacity: 0;
    transform: translateY(80px) scale(0.85) rotate(-6deg);
    filter: blur(8px);
    transition:
      opacity 0.6s,
      transform 0.6s,
      filter 0.6s;
  }
</style>

<script>
  import gsap from 'gsap'
  import { ScrollTrigger } from 'gsap/ScrollTrigger'

  gsap.registerPlugin(ScrollTrigger)

  // Animación interesante al hacer scroll en las cards
  const scrollAnimation = () => {
    const cards = document.querySelectorAll('.project-card')
    cards.forEach((card, i) => {
      gsap.fromTo(
        card,
        {
          opacity: 0,
          y: 80,
          scale: 0.85,
          rotate: -6,
          filter: 'blur(8px)',
        },
        {
          opacity: 1,
          y: 0,
          scale: 1,
          rotate: 0,
          filter: 'blur(0px)',
          duration: 1,
          ease: 'power3.out',
          delay: i * 0.08,
          scrollTrigger: {
            trigger: card,
            start: 'top 80%',
            toggleActions: 'play none none none',
          },
        }
      )
    })
  }

  document.addEventListener('DOMContentLoaded', () => {
    scrollAnimation()
    // ... código de modales ...
    const songOpenButtons = document.querySelectorAll('.song-open')
    songOpenButtons.forEach((button) => {
      button.addEventListener('click', (e) => {
        e.stopPropagation()
        const content = button.closest('.content')
        const modal = content ? content.querySelector('.song-modal') : null

        if (modal && content) {
          modal.classList.add('active')
          content.classList.add('active')
        }
      })
    })

    const songCloseButtons = document.querySelectorAll('.song-close')
    songCloseButtons.forEach((button) => {
      button.addEventListener('click', (e) => {
        e.stopPropagation()
        const modal = button.closest('.song-modal')

        if (modal) {
          modal.classList.remove('active')
          const content = modal.closest('.content')
          if (content) {
            content.classList.remove('active')
          }
        }
      })
    })
  })

  if (
    document.readyState === 'complete' ||
    document.readyState === 'interactive'
  ) {
    setTimeout(() => {
      scrollAnimation()
    }, 100)
  }
</script>
